{"version":3,"file":"useDevicePortalOutput.js","sources":["../src/useDevicePortalOutput.ts"],"sourcesContent":["import { useMemo, useState, type Dispatch, type SetStateAction } from 'react'\nimport { Responder } from './webrtc/Responder'\n\n// @TODO: warn if one room is used by multiple useDevicePortalOutput hooks more than once at the same time\n\ntype State = {\n\troom: string\n\tvalue: string\n\tsendValueToInput: (value: string) => void\n}\n\nconst responders: {\n\t[room: string]: {\n\t\tresponder: Responder\n\t\tfirstValuePromise: Promise<string>\n\t\toutput: null | { value: string; sendValueToInput: (value: string) => void }\n\t\tsetValueState: Dispatch<SetStateAction<State>>\n\t}\n} = {}\n\nexport const useDevicePortalOutput = (\n\troom: string,\n\toptions?: {\n\t\twebsocketSignalingServer?: string\n\t},\n): Pick<State, 'value' | 'sendValueToInput'> => {\n\tconst [valueState, setValueState] = useState<State | null>(null)\n\tconst output = useMemo(() => {\n\t\tif (valueState === null || valueState.room !== room) {\n\t\t\treturn null\n\t\t}\n\t\treturn {\n\t\t\tvalue: valueState.value,\n\t\t\tsendValueToInput: valueState.sendValueToInput,\n\t\t}\n\t}, [])\n\n\tif (!responders[room]) {\n\t\tconst { promise: firstValuePromise, resolve: firstValueResolve } =\n\t\t\tPromise.withResolvers<string>()\n\t\tconst responder = new Responder(room, {\n\t\t\tonValue: (value) => {\n\t\t\t\tresponders[room].output = { value, sendValueToInput }\n\t\t\t\tresponders[room].setValueState({ room, value, sendValueToInput })\n\t\t\t\tfirstValueResolve(value)\n\t\t\t},\n\t\t\tsendLastValueOnConnectAndReconnect: false,\n\t\t\twebsocketSignalingServer: options?.websocketSignalingServer,\n\t\t})\n\t\tconst sendValueToInput = (value: string) => {\n\t\t\tresponder.send(value)\n\t\t}\n\t\tresponders[room] = {\n\t\t\tresponder,\n\t\t\tfirstValuePromise,\n\t\t\toutput: null,\n\t\t\tsetValueState,\n\t\t}\n\t}\n\tresponders[room].setValueState = setValueState\n\n\tif (output) {\n\t\treturn output\n\t}\n\tif (responders[room].output) {\n\t\treturn responders[room].output\n\t}\n\tthrow responders[room].firstValuePromise\n}\n"],"names":["responders","useDevicePortalOutput","room","options","_useState","useState","_useState2","_slicedToArray","valueState","setValueState","output","useMemo","value","sendValueToInput","_Promise$withResolver","Promise","withResolvers","firstValuePromise","promise","firstValueResolve","resolve","responder","Responder","onValue","sendLastValueOnConnectAndReconnect","websocketSignalingServer","send"],"mappings":";;;;AAGA;;AAQA,IAAMA,UAOL,GAAG,EAAE;AAEC,IAAMC,qBAAqB,GAAG,SAAxBA,qBAAqBA,CACjCC,IAAY,EACZC,OAEC,EAC8C;AAC/C,EAAA,IAAAC,SAAA,GAAoCC,QAAQ,CAAe,IAAI,CAAC;IAAAC,UAAA,GAAAC,cAAA,CAAAH,SAAA,EAAA,CAAA,CAAA;AAAzDI,IAAAA,UAAU,GAAAF,UAAA,CAAA,CAAA,CAAA;AAAEG,IAAAA,aAAa,GAAAH,UAAA,CAAA,CAAA,CAAA;AAChC,EAAA,IAAMI,MAAM,GAAGC,OAAO,CAAC,YAAM;IAC5B,IAAIH,UAAU,KAAK,IAAI,IAAIA,UAAU,CAACN,IAAI,KAAKA,IAAI,EAAE;AACpD,MAAA,OAAO,IAAI;AACZ;IACA,OAAO;MACNU,KAAK,EAAEJ,UAAU,CAACI,KAAK;MACvBC,gBAAgB,EAAEL,UAAU,CAACK;KAC7B;GACD,EAAE,EAAE,CAAC;AAEN,EAAA,IAAI,CAACb,UAAU,CAACE,IAAI,CAAC,EAAE;AACtB,IAAA,IAAAY,qBAAA,GACCC,OAAO,CAACC,aAAa,EAAU;MADfC,iBAAiB,GAAAH,qBAAA,CAA1BI,OAAO;MAA8BC,iBAAiB,GAAAL,qBAAA,CAA1BM,OAAO;AAE3C,IAAA,IAAMC,SAAS,GAAG,IAAIC,SAAS,CAACpB,IAAI,EAAE;AACrCqB,MAAAA,OAAO,EAAE,SAATA,OAAOA,CAAGX,KAAK,EAAK;AACnBZ,QAAAA,UAAU,CAACE,IAAI,CAAC,CAACQ,MAAM,GAAG;AAAEE,UAAAA,KAAK,EAALA,KAAK;AAAEC,UAAAA,gBAAgB,EAAhBA;SAAkB;AACrDb,QAAAA,UAAU,CAACE,IAAI,CAAC,CAACO,aAAa,CAAC;AAAEP,UAAAA,IAAI,EAAJA,IAAI;AAAEU,UAAAA,KAAK,EAALA,KAAK;AAAEC,UAAAA,gBAAgB,EAAhBA;AAAiB,SAAC,CAAC;QACjEM,iBAAiB,CAACP,KAAK,CAAC;OACxB;AACDY,MAAAA,kCAAkC,EAAE,KAAK;AACzCC,MAAAA,wBAAwB,EAAEtB,OAAO,KAAA,IAAA,IAAPA,OAAO,KAAA,MAAA,GAAA,MAAA,GAAPA,OAAO,CAAEsB;AACpC,KAAC,CAAC;AACF,IAAA,IAAMZ,gBAAgB,GAAG,SAAnBA,gBAAgBA,CAAID,OAAa,EAAK;AAC3CS,MAAAA,SAAS,CAACK,IAAI,CAACd,OAAK,CAAC;KACrB;IACDZ,UAAU,CAACE,IAAI,CAAC,GAAG;AAClBmB,MAAAA,SAAS,EAATA,SAAS;AACTJ,MAAAA,iBAAiB,EAAjBA,iBAAiB;AACjBP,MAAAA,MAAM,EAAE,IAAI;AACZD,MAAAA,aAAa,EAAbA;KACA;AACF;AACAT,EAAAA,UAAU,CAACE,IAAI,CAAC,CAACO,aAAa,GAAGA,aAAa;AAE9C,EAAA,IAAIC,MAAM,EAAE;AACX,IAAA,OAAOA,MAAM;AACd;AACA,EAAA,IAAIV,UAAU,CAACE,IAAI,CAAC,CAACQ,MAAM,EAAE;AAC5B,IAAA,OAAOV,UAAU,CAACE,IAAI,CAAC,CAACQ,MAAM;AAC/B;AACA,EAAA,MAAMV,UAAU,CAACE,IAAI,CAAC,CAACe,iBAAiB;AACzC;;;;"}